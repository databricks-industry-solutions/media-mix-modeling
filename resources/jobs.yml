resources:
  jobs:
    mmm_example:
      name: "[${bundle.target}] MMM Example"

      tasks:
        - task_key: generate_data
          environment_key: serverless
          notebook_task:
            notebook_path: ../01_generate_data.ipynb
            base_parameters:
              catalog_name: ${var.catalog_name}
              schema_name: ${var.schema_name}
              gold_table_name: ${var.gold_table_name}

        - task_key: fit_model
          depends_on:
            - task_key: generate_data
          environment_key: serverless
          notebook_task:
            notebook_path: ../02_fit_model.ipynb
            base_parameters:
              catalog_name: ${var.catalog_name}
              schema_name: ${var.schema_name}
              gold_table_name: ${var.gold_table_name}
              experiment_name: ${var.experiment_name}

      environments:
        - environment_key: serverless
          spec:
            environment_version: "4"
            dependencies:
              - -r ../requirements.txt

      schedule:
        quartz_cron_expression: "0 0 2 * * ?"
        timezone_id: "UTC"
        pause_status: PAUSED

      email_notifications:
        on_failure:
          - ${workspace.current_user.userName}

      # Permissions are defined per target in databricks.yml
      # to support both user-based (dev) and service principal-based (stg/prd) deployments

      max_concurrent_runs: 1