resources:
  jobs:
    mmm_example:
      name: "[${bundle.target}] MMM Example"

      tasks:
        - task_key: generate_data
          environment_key: serverless
          notebook_task:
            notebook_path: ../generate_data.py
            base_parameters:
              catalog_name: ${var.catalog_name}
              schema_name: ${var.schema_name}
              gold_table_name: ${var.gold_table_name}

        - task_key: fit_model
          depends_on:
            - task_key: generate_data
          environment_key: serverless
          notebook_task:
            notebook_path: ../fit_model.py
            base_parameters:
              catalog_name: ${var.catalog_name}
              schema_name: ${var.schema_name}
              gold_table_name: ${var.gold_table_name}
              experiment_name: ${var.experiment_name}

      environments:
        - environment_key: serverless
          spec:
            dependencies:
              - -r ../requirements.txt

      schedule:
        quartz_cron_expression: "0 0 2 * * ?"
        timezone_id: "UTC"
        pause_status: PAUSED

      email_notifications:
        on_failure:
          - ${workspace.current_user.userName}

      permissions:
        - service_principal_name: ${var.service_principal_name}
          level: IS_OWNER
        - group_name: account_users
          level: CAN_VIEW

      max_concurrent_runs: 1